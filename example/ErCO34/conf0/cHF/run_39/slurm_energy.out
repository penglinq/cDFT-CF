Currently Loaded Modulefiles:
 1) gmp/6.2.1-gcc-13.2.0-lcnhyse <aL>             
 2) mpfr/4.2.0-gcc-13.2.0-yy2fkq5 <aL>            
 3) mpc/1.3.1-gcc-13.2.0-5kgoftq <aL>             
 4) zlib-ng/2.1.3-gcc-13.2.0-jetnfwa <aL>         
 5) zstd/1.5.5-gcc-13.2.0-t2lua3l <aL>            
 6) gcc/13.2.0-gcc-13.2.0-w55nxkl                 
 7) cmake/3.20.2-gcc-13.2.0-rp74vpv               
 8) libfabric/1.18.1-gcc-13.2.0-bijxar4 <aL>      
 9) numactl/2.0.14-gcc-13.2.0-etkf74e <aL>        
10) openssh/8.7p1-gcc-13.2.0-g55xmkx <aL>         
11) slurm/22.05.6-gcc-13.2.0-tchsn6y <aL>         
12) openmpi/4.1.5-gcc-13.2.0-24q3ap2              
13) libpciaccess/0.17-gcc-13.2.0-r2cijnn <aL>     
14) libiconv/1.17-gcc-13.2.0-ntov4te <aL>         
15) xz/5.4.1-gcc-13.2.0-4xkm5xo <aL>              
16) libxml2/2.10.3-gcc-13.2.0-fr6jcjz <aL>        
17) ncurses/6.4-gcc-13.2.0-4o2yj6n <aL>           
18) hwloc/2.9.1-gcc-13.2.0-gzvfolk <aL>           
19) intel-tbb/2021.9.0-gcc-13.2.0-6nwk3ml <aL>    
20) intel-oneapi-mkl/2023.2.0-gcc-13.2.0-ohvyk7g  

Key:
<module-tag>  <aL>=auto-loaded  
/central/groups/changroup/members/lppeng/holmium/run/paper_final/run_ErCO34/conf2/cHF
Wed Apr 16 00:32:30 PDT 2025
hpc-90-08.cm.cluster
#INFO: **** input file is /central/groups/changroup/members/lppeng/holmium/run/paper_final/run_ErCO34/conf2/cHF/run_39/energy.py ****
'''
constrained dft with given magnetic quantum number
'''
import pyscf
from pyscf import scf
from pyscf.scf.hf import RHF
from pyscf.dft.uks import UKS
from pyscf.dft.gks import GKS
from pyscf import lib
import os, sys
import numpy as np
import scipy.linalg as la
from scipy.linalg import sqrtm, eigh
from scipy.optimize import root
np.set_printoptions(precision=12, threshold=sys.maxsize, linewidth=190, suppress=True)
log = lib.logger.Logger(sys.stdout, 4)

if __name__ == "__main__":
    from pyscf import gto, scf, dft, lib
    from pyscf.lib import chkfile
    from stevens.momentum import get_mj

    # system input
    geometry = 'ErCO34' # The name of geometry file minus ".xyz"
                       # Make sure first atom is the central magnetic atom 
    spin = 3 # number of unpaired electrons in a unit cell
    charge = -5 # charge of the molecule or a unit cell
    basis = {'default': '631g', 'Er': 'sarc-dkh'} # specify basis for all elements here
    max_memory = 40000 # in the unit of MB. Recommend: memory available on a node - 10000 MB
    qmmm = True # add environment with classical charges
    atom_index = 0 # the index of central lanthanide atom

    # (c)HF/DFT parameters
    chkfname = 'constrained_chkfile.chk' 
    xc_lst = ['R2SCAN', 'PBE', 'B3LYP', 'TPSS', 'M06',  'B97-D']
    # END USER INPUT

    # set up system
    if os.path.isfile('../../' + geometry + ".xyz"):
        mol = gto.M(
            atom = '../../' + geometry + ".xyz",
           basis = basis,
            verbose = 4,
            spin = spin,
            charge = charge,
            max_memory = max_memory,
            )
        mol.set_common_origin(mol._atom[atom_index][1])
    else:
        raise ValueError("No .xyz file available!")
    log.info("N_elec %s, N_ao %s"%(mol.nelec, mol.nao))

    assert chkfname is not None
    mf = scf.GKS(mol).x2c()
    data = chkfile.load(chkfname, 'scf')
    mf.__dict__.update(data)
    dm = mf.make_rdm1()
    for xc in xc_lst:
        mf = scf.GKS(mol).x2c()
        if qmmm: # add the precomputed potential from environmental classical charges 
            get_hcore_original = mf.get_hcore
            hcore_mm = np.load('../../mm_hcore.npy')
            def get_hcore_mm(self, mol=None):
                return get_hcore_original(mol=mol) + la.block_diag(hcore_mm, hcore_mm)
            import types
            mf.get_hcore = types.MethodType(get_hcore_mm, mf)
        mf.collinear = 'mcol'
        mf.grids.level = 6
        mf.xc = xc
        print("energy with functional %s"%mf.xc, mf.energy_tot(dm=dm))
    print("S vector", get_mj(mol, dm, include_L=False))
    print("L vector", get_mj(mol, dm, include_S=False))
    print("J vector", get_mj(mol, dm))
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-90-08.cm.cluster', release='5.14.0-427.13.1.el9_4.x86_64', version='#1 SMP PREEMPT_DYNAMIC Wed Apr 10 10:29:16 EDT 2024', machine='x86_64')  Threads 8
Python 3.11.6 | packaged by conda-forge | (main, Oct  3 2023, 10:40:35) [GCC 12.3.0]
numpy 1.26.0  scipy 1.11.3
Date: Wed Apr 16 00:32:33 2025
PySCF version 2.5.0
PySCF path  /home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 17
[INPUT] num. electrons = 193
[INPUT] charge = -5
[INPUT] spin (= nelec alpha-beta = 2S) = 3
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Er     0.983621000000  15.502244000000  16.207915000000 AA    1.858774300371  29.294995476182  30.628520400230 Bohr   0.0
[INPUT]  2 O      1.999162000000  14.046589000000  17.748158000000 AA    3.777868658638  26.544206194328  33.539157835508 Bohr   0.0
[INPUT]  3 O      0.849859000000  13.239725000000  19.509454000000 AA    1.606000754497  25.019454214557  36.867524899800 Bohr   0.0
[INPUT]  4 O     -0.191063000000  14.330252000000  17.844156000000 AA   -0.361056742538  27.080251576001  33.720567764014 Bohr   0.0
[INPUT]  5 O      0.075398000000  13.922617000000  14.734947000000 AA    0.142481570340  26.309933067214  27.845014289982 Bohr   0.0
[INPUT]  6 O      1.310036000000  13.048514000000  13.067690000000 AA    2.475609253321  24.658117792553  24.694355180718 Bohr   0.0
[INPUT]  7 O      2.203594000000  14.429009000000  14.574295000000 AA    4.164189149735  27.266875258884  27.541426008618 Bohr   0.0
[INPUT]  8 O     -1.142155000000  16.458779000000  15.996655000000 AA   -2.158360141803  31.102584654743  30.229296859154 Bohr   0.0
[INPUT]  9 O      0.436800000000  17.108053000000  14.609560000000 AA    0.825432371210  32.329534694544  27.608067200401 Bohr   0.0
[INPUT] 10 O      1.479297000000  17.162683000000  17.755992000000 AA    2.795466186891  32.432770432729  33.553961949968 Bohr   0.0
[INPUT] 11 O      3.574079000000  17.921221000000  18.087093000000 AA    6.754030457559  33.866199507804  34.179652159538 Bohr   0.0
[INPUT] 12 O      3.086741000000  16.549131000000  16.376735000000 AA    5.833095107466  31.273325189550  30.947543964579 Bohr   0.0
[INPUT] 13 C      0.893280000000  13.851177000000  18.394684000000 AA    1.688054552551  26.174931032875  34.760914907919 Bohr   0.0
[INPUT] 14 C      1.209619000000  13.783938000000  14.098216000000 AA    2.285848625070  26.047867737985  26.641767084961 Bohr   0.0
[INPUT] 15 C     -0.820004000000  17.160582000000  14.960252000000 AA   -1.549582981048  32.428800118141  28.270779034477 Bohr   0.0
[INPUT] 16 C      2.757666000000  17.225719000000  17.422934000000 AA    5.211233483025  32.551891208717  32.924573546373 Bohr   0.0
[INPUT] 17 O     -1.665533000000  17.832969000000  14.307847000000 AA   -3.147401221425  33.699427397859  27.037912262180 Bohr   0.0

nuclear repulsion = 2660.00686642269
number of shells = 122
number of NR pGTOs = 525
number of NR cGTOs = 264
basis = {'default': '631g', 'Er': 'sarc-dkh'}
ecp = {}
CPU time:         2.14
N_elec (98, 95), N_ao 264
tot grids = 1067264
energy with functional R2SCAN -14200.657146363588
tot grids = 1067264
Exception ignored in: <function _TemporaryFileCloser.__del__ at 0x7f531e4d3560>
Traceback (most recent call last):
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 450, in __del__
    self.close()
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 446, in close
    unlink(self.name)
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp5phovvv5'
Exception ignored in: <function _TemporaryFileCloser.__del__ at 0x7f531e4d3560>
Traceback (most recent call last):
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 450, in __del__
    self.close()
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 446, in close
    unlink(self.name)
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp5phovvv5'
Exception ignored in: <function _TemporaryFileCloser.__del__ at 0x7f531e4d3560>
Traceback (most recent call last):
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 450, in __del__
    self.close()
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 446, in close
    unlink(self.name)
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp5phovvv5'
Exception ignored in: <function _TemporaryFileCloser.__del__ at 0x7f531e4d3560>
Traceback (most recent call last):
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 450, in __del__
    self.close()
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 446, in close
    unlink(self.name)
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp5phovvv5'
Exception ignored in: <function _TemporaryFileCloser.__del__ at 0x7f531e4d3560>
Traceback (most recent call last):
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 450, in __del__
    self.close()
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 446, in close
    unlink(self.name)
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp5phovvv5'
Exception ignored in: <function _TemporaryFileCloser.__del__ at 0x7f531e4d3560>
Traceback (most recent call last):
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 450, in __del__
    self.close()
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 446, in close
    unlink(self.name)
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp5phovvv5'
Exception ignored in: <function _TemporaryFileCloser.__del__ at 0x7f531e4d3560>
Exception ignored in: <function _TemporaryFileCloser.__del__ at 0x7f531e4d3560>
Traceback (most recent call last):
Traceback (most recent call last):
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 450, in __del__
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 450, in __del__
    self.close()
    self.close()
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 446, in close
  File "/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/tempfile.py", line 446, in close
    unlink(self.name)
    unlink(self.name)
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp5phovvv5'
FileNotFoundError: [Errno 2] No such file or directory: '/tmp/tmp5phovvv5'
energy with functional PBE -14199.935044277365
tot grids = 1067264
/home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/site-packages/pyscf/dft/libxc.py:1102: UserWarning: Since PySCF-2.3, B3LYP (and B3P86) are changed to the VWN-RPA variant, corresponding to the original definition by Stephens et al. (issue 1480) and the same as the B3LYP functional in Gaussian. To restore the VWN5 definition, you can put the setting "B3LYP_WITH_VWN5 = True" in pyscf_conf.py
  warnings.warn('Since PySCF-2.3, B3LYP (and B3P86) are changed to the VWN-RPA variant, '
energy with functional B3LYP -14201.405603601721
tot grids = 1067264
energy with functional TPSS -14200.840085733154
tot grids = 1067264
energy with functional M06 -14200.951362202042
tot grids = 1067264
energy with functional B97-D -14207.706281501218
(3, 264, 264) 264
S vector [ 0.622913743156-0.j -1.053759346806+0.j  0.776532386915-0.j]
(3, 264, 264) 264
L vector [ 2.602075855753-0.j -4.395707666085-0.j  3.218731643754+0.j]
(3, 264, 264) 264
J vector [ 3.224989598909-0.j -5.449467012891-0.j  3.995264030669-0.j]
Wed Apr 16 01:28:22 PDT 2025
