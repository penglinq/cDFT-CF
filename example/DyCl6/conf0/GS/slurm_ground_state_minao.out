Currently Loaded Modulefiles:
 1) gmp/6.2.1-gcc-13.2.0-lcnhyse <aL>             
 2) mpfr/4.2.0-gcc-13.2.0-yy2fkq5 <aL>            
 3) mpc/1.3.1-gcc-13.2.0-5kgoftq <aL>             
 4) zlib-ng/2.1.3-gcc-13.2.0-jetnfwa <aL>         
 5) zstd/1.5.5-gcc-13.2.0-t2lua3l <aL>            
 6) gcc/13.2.0-gcc-13.2.0-w55nxkl                 
 7) cmake/3.20.2-gcc-13.2.0-rp74vpv               
 8) libfabric/1.18.1-gcc-13.2.0-bijxar4 <aL>      
 9) numactl/2.0.14-gcc-13.2.0-etkf74e <aL>        
10) openssh/8.7p1-gcc-13.2.0-g55xmkx <aL>         
11) slurm/22.05.6-gcc-13.2.0-tchsn6y <aL>         
12) openmpi/4.1.5-gcc-13.2.0-24q3ap2              
13) libpciaccess/0.17-gcc-13.2.0-r2cijnn <aL>     
14) libiconv/1.17-gcc-13.2.0-ntov4te <aL>         
15) xz/5.4.1-gcc-13.2.0-4xkm5xo <aL>              
16) libxml2/2.10.3-gcc-13.2.0-fr6jcjz <aL>        
17) ncurses/6.4-gcc-13.2.0-4o2yj6n <aL>           
18) hwloc/2.9.1-gcc-13.2.0-gzvfolk <aL>           
19) intel-tbb/2021.9.0-gcc-13.2.0-6nwk3ml <aL>    
20) intel-oneapi-mkl/2023.2.0-gcc-13.2.0-ohvyk7g  

Key:
<module-tag>  <aL>=auto-loaded  
/central/groups/changroup/members/lppeng/holmium/run/paper_final/run_Dy/conf4/GS
Fri Mar 14 13:35:58 PDT 2025
hpc-21-35.cm.cluster
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   hpc-21-35
  Local device: mlx5_0
--------------------------------------------------------------------------
Mar 14 13:36:11 ####### 
                ####### libDMET   version 0.5
                ####### A periodic DMET library for lattice model and realistic solid.
                ####### 
#INFO: **** input file is /central/groups/changroup/members/lppeng/holmium/run/paper_final/run_Dy/conf4/GS/ground_state.py ****
'''
Example input to calculate the ground state of a molecular system
Include x2c relativistic effect
'''
import pyscf
from pyscf.scf.hf import RHF
from pyscf.dft.uks import UKS
from pyscf.dft.gks import GKS
from pyscf import lib
import os, sys
import numpy as np
import scipy.linalg as la
from scipy.linalg import sqrtm, eigh
from scipy.optimize import root
np.set_printoptions(precision=12, threshold=sys.maxsize, linewidth=190, suppress=True)
log = lib.logger.Logger(sys.stdout, 4)

if __name__ == "__main__":
    from pyscf import gto, scf, dft, lib
    from pyscf.lib import chkfile
    from stevens import cdft, project, utils
    from stevens.project import get_mj

    # system input
    geometry = 'DyCl6' # The name of geometry file minus ".xyz"
                       # Make sure first atom is the central magnetic atom 
    spin = 5 # number of unpaired electrons in a unit cell
    charge = -3 # charge of the molecule or a unit cell
    basis = {'default': 'minao', 'Dy': 'cc-x2c-minao'} # specify basis for all elements here
    max_memory = 32000 # in the unit of MB. Recommend: memory available on a node - 10000 MB
    qmmm = True # add environment with classical charges

    # (c)HF/DFT parameters
    xc = 'HF' # functional
    smearing = None # To help HF/DFT converge, try e.g. 5e-2
    chkfname_guess = 'minao' # initial guess. 'minao' for default PySCF guess; None for constrained HF; 
                # path to a checkpoint file to restart from a SCF solution.
                # 'project' to project from the SCF solution in a small basis to generate the initial guess
    chkfname_small = '../gs_small_%s.chk'%geometry # checkpoint file in a small basis. Used when chkfname_guess == 'project'
    basis_small = {'default': 'minao', 'Dy': 'cc-x2c-minao'}# the small basis associated with chkfname_small
    change_dm_mode = 'positive_z' # None: no change
                          # 'positive_z': set the 4f block of dm so that J~(0,0,J)
                          # 'rotate': rotate the 4f block of dm by some angles
    atom_index = 0 # the index of central lanthanide atom
    occ_idx = 20 # index of angles in a sequence to sample xz plane and xy plane
    noise = 0 # max noise on density matrix initial guess

    # constrained HF parameters for the initial guess
    ao_shell = 'f'
    lo_chkfname = '../UHF/uhf_gs_%s_lo.h5'%geometry  
    multiplier0 = 0.1
    # END USER INPUT

    # set up system
    if os.path.isfile('../' + geometry + ".xyz"):
        mol = gto.M(
            atom = '../' + geometry + ".xyz",
            basis = basis,
            verbose = 4,
            spin = spin,
            charge = charge,
            max_memory = max_memory,
            )
        mol.set_common_origin(mol._atom[atom_index][1])
    else:
        raise ValueError("No .xyz file available!")
    log.info("N_elec %s, N_ao %s"%(mol.nelec, mol.nao))

    # generate HF/DFT initial guess
    if chkfname_guess == 'minao':
        mf = scf.GKS(mol).x2c()
        dm0 = mf.get_init_guess()
        print("Use PySCF default init guess")
    elif chkfname_guess is None:
        # run constrained DFT
        angles = cdft.sample_rotation('xyz', occ_idx, unit=20)
        from scipy.spatial.transform import Rotation
        direction = Rotation.from_euler('zyz', angles, degrees=False) @ [0,0,1]
        cmf = cdft.CGKS(mol, direction, multiplier_guess=multiplier0, max_cycle=300,
                atom_index=atom_index, ao_shell='f', lo_chkfname=lo_chkfname, xc=xc, smearing=smearing)
        cmf.kernel()
        dm0 = cmf._scf.make_rdm1()
        print("Contrained SCF solution as init guess")
    elif chkfname_guess == 'project':
        # project dm0 in a small basis to the larger basis 
        dm0 = utils.project_dm_from_small_basis(mol, basis_small, chkfname_small, change_dm_mode, atom_index=atom_index, occ_idx=occ_idx)
        print("Project wavefunction in a smaller basis to the target basis as init guess")
    else:
        mf = scf.GKS(mol).x2c()
        data = chkfile.load(chkfname_guess, 'scf')
        mf.__dict__.update(data)
        dm0 = mf.make_rdm1()
        mf.analyze(with_meta_lowdin=False)
        print("Load .chk file for init guess")
    if change_dm_mode is not None and not chkfname_guess == 'project': # when chkfname_guess == 'project', change in small basis
        dm0 = utils.change_dm_guess(mol, dm0, change_dm_mode, atom_index=atom_index, occ_idx=occ_idx)
    dm0 += (np.random.rand(*(dm0.shape)) - 0.5) * noise  
    print("J vector of initial guess", get_mj(mol, dm0, analyze=True))

    # run HF/DFT
    mf = scf.GKS(mol).x2c()
    mf.xc = xc
    if xc.upper() != 'HF':
        mf.collinear = 'mcol'
        mf.grids.level = 6 
    mf.chkfile = 'gs_small_' + geometry + '.chk' 
    mf.max_cycle = 1000 
    if smearing is not None:
        mf = scf.addons.smearing_(mf, sigma=smearing, method="fermi")
    if qmmm: # add the precomputed potential from environmental classical charges 
        get_hcore_original = mf.get_hcore
        hcore_mm = np.load('../mm_hcore_minao.npy')
        def get_hcore_mm(self, mol=None):
            return get_hcore_original(mol=mol) + la.block_diag(hcore_mm, hcore_mm)
        import types
        mf.get_hcore = types.MethodType(get_hcore_mm, mf)
    mf.kernel(dm0=dm0)
    dm = mf.make_rdm1()
    print("S vector", get_mj(mol, dm, include_L=False))
    print("L vector", get_mj(mol, dm, include_S=False))
    print("J vector", get_mj(mol, dm))
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='hpc-21-35.cm.cluster', release='5.14.0-362.24.1.el9_3.x86_64', version='#1 SMP PREEMPT_DYNAMIC Thu Feb 15 07:18:13 EST 2024', machine='x86_64')  Threads 16
Python 3.11.6 | packaged by conda-forge | (main, Oct  3 2023, 10:40:35) [GCC 12.3.0]
numpy 1.26.0  scipy 1.11.3
Date: Fri Mar 14 13:36:15 2025
PySCF version 2.5.0
PySCF path  /home/lppeng/anaconda3/envs/nerscV25/lib/python3.11/site-packages/pyscf

[CONFIG] conf_file None
[INPUT] verbose = 4
[INPUT] num. atoms = 7
[INPUT] num. electrons = 171
[INPUT] charge = -3
[INPUT] spin (= nelec alpha-beta = 2S) = 5
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Dy     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  2 Cl     2.724000000000   0.000000000000   0.000000000000 AA    5.147613963315   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  3 Cl    -2.724000000000   0.000000000000   0.000000000000 AA   -5.147613963315   0.000000000000   0.000000000000 Bohr   0.0
[INPUT]  4 Cl     0.000000000000   2.724000000000   0.000000000000 AA    0.000000000000   5.147613963315   0.000000000000 Bohr   0.0
[INPUT]  5 Cl     0.000000000000  -2.724000000000   0.000000000000 AA    0.000000000000  -5.147613963315   0.000000000000 Bohr   0.0
[INPUT]  6 Cl     0.000000000000   0.000000000000   2.724000000000 AA    0.000000000000   0.000000000000   5.147613963315 Bohr   0.0
[INPUT]  7 Cl     0.000000000000   0.000000000000  -2.724000000000 AA    0.000000000000   0.000000000000  -5.147613963315 Bohr   0.0

nuclear repulsion = 1868.38919656687
number of shells = 16
number of NR pGTOs = 511
number of NR cGTOs = 89
basis = {'default': 'minao', 'Dy': 'cc-x2c-minao'}
ecp = {}
CPU time:         4.12
N_elec (88, 83), N_ao 89
Initial guess from minao.
Use PySCF default init guess
Updated f-block dm with J~(0,0,J)
(3, 89, 89) 89
(3, 178, 178) (89, 89) (3, 89, 89)
elemental J of ['Cl' 'Dy']
  Cl 2.5495+0.0000j 0.0000+0.0000j -0.0000+0.0000j 
  Dy 1.3520-0.0000j 0.0000+0.0000j 7.5000+0.0000j 
J vector of initial guess [3.9015+0.j 0.    -0.j 7.5   +0.j]


******** <class 'pyscf.x2c.x2c.X2C1eGKS'> ********
method = X2C1eGKS
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
diis_damp = 0
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 1000
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = gs_small_DyCl6.chk
max_memory 32000 MB (current use 218 MB)
XC library pyscf.dft.libxc version 6.1.0
    S. Lehtola, C. Steigemann, M. J.T. Oliveira, and M. A.L. Marques.,  SoftwareX 7, 1–5 (2018)
XC functionals = HF

radial grids: 
    Treutler-Ahlrichs [JCP 102, 346 (1995); DOI:10.1063/1.469408] (M4) radial grids
    
becke partition: Becke, JCP 88, 2547 (1988); DOI:10.1063/1.454033
pruning grids: <function nwchem_prune at 0x7f1876881da0>
grids dens level: 3
symmetrized grids: False
atomic radii adjust function: <function treutler_atomic_radii_adjust at 0x7f18768823e0>
small_rho_cutoff = 1e-07
collinear = col


******** <class 'pyscf.x2c.x2c.SpinOrbitalX2CHelper'> ********
approx = 1e
xuncontract = 1
Overwritten attributes  get_hcore  of <class 'pyscf.x2c.x2c.X2C1eGKS'>
Set gradient conv threshold to 3.16228e-05
tot grids = 134432
init E= -14970.9079850195
  HOMO = -1.29237288743028  LUMO = -1.2723830239512
cycle= 1 E= -14974.744595196  delta_E= -3.84  |g|= 0.147  |ddm|= 1.59
  HOMO = -0.27191438112876  LUMO = 0.0526026166984392
cycle= 2 E= -14974.7612346208  delta_E= -0.0166  |g|= 0.0449  |ddm|= 0.261
  HOMO = -0.27582021908058  LUMO = -0.0120628713606044
cycle= 3 E= -14974.7645592829  delta_E= -0.00332  |g|= 0.0378  |ddm|= 0.0764
  HOMO = -0.276547809459407  LUMO = -0.0207401450875643
cycle= 4 E= -14974.7690007025  delta_E= -0.00444  |g|= 0.0294  |ddm|= 0.115
  HOMO = -0.27637073985886  LUMO = -0.0097435254867817
cycle= 5 E= -14974.7747686443  delta_E= -0.00577  |g|= 0.0114  |ddm|= 0.273
  HOMO = -0.275912906439116  LUMO = -0.0266015468213825
cycle= 6 E= -14974.7757142627  delta_E= -0.000946  |g|= 0.00482  |ddm|= 0.106
  HOMO = -0.276265518368633  LUMO = -0.0239567500273017
cycle= 7 E= -14974.7757917852  delta_E= -7.75e-05  |g|= 0.00283  |ddm|= 0.0233
  HOMO = -0.276209306542876  LUMO = -0.0199936270918943
cycle= 8 E= -14974.7758219142  delta_E= -3.01e-05  |g|= 0.00203  |ddm|= 0.0165
  HOMO = -0.27620366877479  LUMO = -0.0209728252930024
cycle= 9 E= -14974.7758383736  delta_E= -1.65e-05  |g|= 0.00161  |ddm|= 0.00899
  HOMO = -0.276211897569834  LUMO = -0.021255484030222
cycle= 10 E= -14974.7758554066  delta_E= -1.7e-05  |g|= 0.00125  |ddm|= 0.0101
  HOMO = -0.276214639585285  LUMO = -0.0211443436631828
cycle= 11 E= -14974.7758672497  delta_E= -1.18e-05  |g|= 0.00104  |ddm|= 0.00888
  HOMO = -0.276187633581133  LUMO = -0.0212736499774602
cycle= 12 E= -14974.7758751391  delta_E= -7.89e-06  |g|= 0.000909  |ddm|= 0.00703
  HOMO = -0.276178173193938  LUMO = -0.0214942369134832
cycle= 13 E= -14974.7758866552  delta_E= -1.15e-05  |g|= 0.000682  |ddm|= 0.0127
  HOMO = -0.276178083382576  LUMO = -0.0215536321262638
cycle= 14 E= -14974.77589245  delta_E= -5.79e-06  |g|= 0.000523  |ddm|= 0.00886
  HOMO = -0.276183626093565  LUMO = -0.0214785956759545
cycle= 15 E= -14974.7758956313  delta_E= -3.18e-06  |g|= 0.000387  |ddm|= 0.00715
  HOMO = -0.276189783431933  LUMO = -0.0214653119512051
cycle= 16 E= -14974.7758972744  delta_E= -1.64e-06  |g|= 0.000237  |ddm|= 0.00575
  HOMO = -0.276191418240898  LUMO = -0.0213667650276317
cycle= 17 E= -14974.775897878  delta_E= -6.04e-07  |g|= 0.000123  |ddm|= 0.00365
  HOMO = -0.276192091275432  LUMO = -0.021262514765082
cycle= 18 E= -14974.7758979632  delta_E= -8.52e-08  |g|= 0.000104  |ddm|= 0.000985
  HOMO = -0.276194140332457  LUMO = -0.0212235479566139
cycle= 19 E= -14974.7758980167  delta_E= -5.35e-08  |g|= 9.65e-05  |ddm|= 0.000506
  HOMO = -0.276195447950416  LUMO = -0.0211938711819402
cycle= 20 E= -14974.7758980771  delta_E= -6.04e-08  |g|= 9.3e-05  |ddm|= 0.000518
  HOMO = -0.276196081257951  LUMO = -0.0211832648456575
cycle= 21 E= -14974.7758981288  delta_E= -5.17e-08  |g|= 9.18e-05  |ddm|= 0.000445
  HOMO = -0.276196592287204  LUMO = -0.0211740001215249
cycle= 22 E= -14974.7758981985  delta_E= -6.97e-08  |g|= 9.09e-05  |ddm|= 0.000575
  HOMO = -0.276196798343567  LUMO = -0.0211571217656093
cycle= 23 E= -14974.7758983079  delta_E= -1.09e-07  |g|= 8.97e-05  |ddm|= 0.000893
  HOMO = -0.27619699197415  LUMO = -0.0211408807275552
cycle= 24 E= -14974.7758984511  delta_E= -1.43e-07  |g|= 8.86e-05  |ddm|= 0.00119
  HOMO = -0.276197292684024  LUMO = -0.021138006646204
cycle= 25 E= -14974.7758986357  delta_E= -1.85e-07  |g|= 8.72e-05  |ddm|= 0.00155
  HOMO = -0.276196956230961  LUMO = -0.0211346810670702
cycle= 26 E= -14974.7758989919  delta_E= -3.56e-07  |g|= 8.48e-05  |ddm|= 0.00307
  HOMO = -0.276196413542677  LUMO = -0.0211256845777648
cycle= 27 E= -14974.7758993874  delta_E= -3.95e-07  |g|= 8.23e-05  |ddm|= 0.00357
  HOMO = -0.276196421744313  LUMO = -0.0211185206444429
cycle= 28 E= -14974.7758999281  delta_E= -5.41e-07  |g|= 7.82e-05  |ddm|= 0.00517
  HOMO = -0.276196192217148  LUMO = -0.0211006206029732
cycle= 29 E= -14974.7759005851  delta_E= -6.57e-07  |g|= 7.34e-05  |ddm|= 0.0069
  HOMO = -0.276196057704377  LUMO = -0.0210830634030066
cycle= 30 E= -14974.7759011556  delta_E= -5.71e-07  |g|= 6.88e-05  |ddm|= 0.00671
  HOMO = -0.276196148784252  LUMO = -0.0210675592415035
cycle= 31 E= -14974.7759016961  delta_E= -5.41e-07  |g|= 6.39e-05  |ddm|= 0.00721
  HOMO = -0.276196056602633  LUMO = -0.0210582791179608
cycle= 32 E= -14974.7759021364  delta_E= -4.4e-07  |g|= 5.91e-05  |ddm|= 0.00674
  HOMO = -0.27619550114033  LUMO = -0.021041637704102
cycle= 33 E= -14974.7759025149  delta_E= -3.78e-07  |g|= 5.38e-05  |ddm|= 0.00675
  HOMO = -0.27619563492065  LUMO = -0.0210507158311768
cycle= 34 E= -14974.7759029536  delta_E= -4.39e-07  |g|= 4.49e-05  |ddm|= 0.00983
  HOMO = -0.276195046229989  LUMO = -0.0210431156796324
cycle= 35 E= -14974.7759032266  delta_E= -2.73e-07  |g|= 3.63e-05  |ddm|= 0.00874
  HOMO = -0.276194691227014  LUMO = -0.0210467665873358
cycle= 36 E= -14974.7759033654  delta_E= -1.39e-07  |g|= 2.78e-05  |ddm|= 0.00688
  HOMO = -0.276194604954937  LUMO = -0.0210347153893379
cycle= 37 E= -14974.7759034095  delta_E= -4.41e-08  |g|= 2.14e-05  |ddm|= 0.00337
  HOMO = -0.27619501429173  LUMO = -0.0210295399111216
cycle= 38 E= -14974.7759034242  delta_E= -1.47e-08  |g|= 1.67e-05  |ddm|= 0.00138
  HOMO = -0.276195350450271  LUMO = -0.0210206116004095
cycle= 39 E= -14974.7759034286  delta_E= -4.39e-09  |g|= 1.27e-05  |ddm|= 0.000361
  HOMO = -0.27619554998756  LUMO = -0.0210185750675081
cycle= 40 E= -14974.7759034316  delta_E= -3.06e-09  |g|= 1.02e-05  |ddm|= 0.000353
  HOMO = -0.276195544924053  LUMO = -0.0210238422891796
cycle= 41 E= -14974.7759034342  delta_E= -2.6e-09  |g|= 8.96e-06  |ddm|= 0.000408
  HOMO = -0.27619523033809  LUMO = -0.0210280787335986
cycle= 42 E= -14974.7759034366  delta_E= -2.36e-09  |g|= 7.55e-06  |ddm|= 0.000362
  HOMO = -0.276195031561406  LUMO = -0.0210312681663911
cycle= 43 E= -14974.7759034396  delta_E= -3.01e-09  |g|= 6.56e-06  |ddm|= 0.000638
  HOMO = -0.27619505092049  LUMO = -0.0210341887757455
cycle= 44 E= -14974.7759034411  delta_E= -1.51e-09  |g|= 6.12e-06  |ddm|= 0.000425
  HOMO = -0.276195011031186  LUMO = -0.0210324235888095
cycle= 45 E= -14974.7759034424  delta_E= -1.31e-09  |g|= 5.34e-06  |ddm|= 0.000381
  HOMO = -0.276195081002641  LUMO = -0.0210301670151795
cycle= 46 E= -14974.7759034437  delta_E= -1.27e-09  |g|= 4.25e-06  |ddm|= 0.000403
  HOMO = -0.276195199346861  LUMO = -0.021029372623276
cycle= 47 E= -14974.7759034444  delta_E= -7.02e-10  |g|= 3.4e-06  |ddm|= 0.000296
  HOMO = -0.276195180715401  LUMO = -0.0210288583547276
Extra cycle  E= -14974.7759034444  delta_E= -3.64e-11  |g|= 3.21e-06  |ddm|= 4.23e-06
converged SCF energy = -14974.7759034444  <S^2> = 7.9778769  2S+1 = 5.7368552
(3, 89, 89) 89
(3, 178, 178) (89, 89) (3, 89, 89)
S vector [ 0.0009-0.j -0.    +0.j  2.3408+0.j]
(3, 89, 89) 89
(3, 178, 178) (89, 89) (3, 89, 89)
L vector [ 0.0017-0.j -0.    -0.j  5.1353+0.j]
(3, 89, 89) 89
(3, 178, 178) (89, 89) (3, 89, 89)
J vector [ 0.0026-0.j -0.    -0.j  7.4761+0.j]
Fri Mar 14 13:36:59 PDT 2025
